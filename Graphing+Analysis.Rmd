---
title: "ABB Analysis Tasks"
author: "Molly Wilson"
date: "12/5/2017"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
    number_sections: true

---

```{r,message=FALSE,warning=FALSE, echo=FALSE}
# set up
library(rmarkdown)
library(dplyr)
library(tidyr)
library(lazyeval)
library(ggplot2)
library(ellipse)
library(RColorBrewer)
library(ggbiplot)
library(corrplot)
library(nlme)
library(pls)
library(factoextra)
```
```{r,message=FALSE,warning=FALSE, echo=FALSE}
setwd("~/github/Scarid-Behavior/data")
site.sum <- read.csv("site.sum.csv", stringsAsFactors=FALSE) %>% select(-X)
data <- read.csv("sumID2.csv", stringsAsFactors=FALSE) %>% select(Island,Site,Spearfishing,Diving,Species,Species.Code,Phase,Length.cm,g.frac,FR,BR,TDB,for.dur,for.bites,tot.BM,tot.DEN,scar.BM,herb.BM,scar.DEN,conspec.BM,conspec.DEN,carn.BM,carn.DEN,cover_CCA,cover_LC,cover_MA,cover_TA,canopy_MA,canopy_TA,rugosity,int.tot,int.scar,int.con,int.hetscar,int.dam)
```

# Data overview:
- Fish follows (2 min) conducted at sites in Antigua (6), Barbuda (3) and Bonaire (4) from March-August 2017
- Follows tracked time spent grazing, bite rates, and competitive interactions (among scarids and with damselfish)
- Follows targeted *Sparisoma viride*, *Scarus vetula*, and *Sparisoma aurofrenatum* of both initial and terminal phases 
  +*Sparisoma aurofrenatum* were not followed in Bonaire, but added in Antigua and Bonaire due to low abundances of other two species. Some sites in Antigua and Barbuda had no/low represenation from terminal phase *viride* and *vetula*
- Site level factors (benthic, fish, and rugosity) assessed at each of the 13 sites
```{r,echo=FALSE}
n.sspph <- data %>% group_by(Island, Site, Species, Phase) %>% dplyr::summarize(n=n())
ggplot(data=n.sspph, aes(x=Site, y=n, fill=Phase)) +
    geom_bar(stat="identity", position=position_dodge()) + facet_grid(.~Species) + theme_minimal() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + scale_fill_grey()
# counts <- table(data$Species, data$Site)
# barplot(counts, main="Sample size by phase and species",
#   legend = rownames(counts), beside=TRUE, las=2)
```


# Examing variable distributions and relationships

## Site-level predictor variables: fish, benthic, and rugosity

### Distributions
```{r,warning=FALSE,echo=FALSE}
predictors <- site.sum %>% select(tot.BM,tot.DEN,scar.BM,scar.DEN,carn.BM,carn.DEN,cover_CCA,cover_LC,cover_MA,canopy_MA,cover_TA,canopy_TA,rugosity) %>% gather() %>% na.omit()
ggplot(predictors,aes(value))+facet_wrap(~ key, scales = "free")+geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") 
```

### Correlations
```{r,echo=FALSE}
site.var <- data %>% select(tot.BM,tot.DEN,scar.BM,scar.DEN,conspec.BM,conspec.DEN,carn.BM,carn.DEN,cover_CCA,cover_LC,cover_MA,canopy_MA,cover_TA,canopy_TA,rugosity)
cor=cor(site.var, use="pairwise.complete.obs")
my_colors <- brewer.pal(5, "Spectral")
my_colors=colorRampPalette(my_colors)(100)
ord <- order(cor[1, ])
cor_ord = cor[ord, ord]
plotcorr(cor_ord , col=my_colors[cor_ord*50+50] , mar=c(1,1,1,1)  )
```

Many correlations here, both within benthic/fish categories and across categories. Rugosity is correlated with both fish and benthic variables. I will examine correlations within fish community and benthic community variables to decide which I can omit and which I will integrate through PCA. Whether I include benthic variables as predictor or response variables will determine if I need to worry about fish~benthic correlations.




```{r,echo=FALSE}
panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits=digits)[1]
    txt <- paste(prefix, txt, sep="")
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(~tot.BM+tot.DEN+scar.BM+scar.DEN+conspec.BM+conspec.DEN+carn.BM+carn.DEN+rugosity, data=data,
      lower.panel=panel.smooth, upper.panel=panel.cor, 
      pch=20, main="Fish Community Variables",na.action = na.omit)
```

Variables carn.DEN and carn.BM are essentially identical - I will remove carn.DEN and use carn.BM as the main preditor metric. Total fish biomass and density (tot.BM and tot.DEN) are highly correlated with both scarid and carnivore variables, so I will remove them. Conspecific biomass is highly correlated with scarid biomass so I will remove it as well (and should possibly also remove conspec.DEN?). The selected variables I will proceed with are as follows:
```{r,echo=FALSE}
panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits=digits)[1]
    txt <- paste(prefix, txt, sep="")
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(~scar.BM+scar.DEN+conspec.DEN+carn.BM+rugosity, data=data,
      lower.panel=panel.smooth, upper.panel=panel.cor, 
      pch=20, main="Selected Fish Community Variables",na.action = na.omit)
```

Scarid biomass, carnivore biomass, and rugosity should be integrated via PCA. Scarid density and conspecific density should also be combined, or one should be omitted.

```{r,echo=FALSE}
panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits=digits)[1]
    txt <- paste(prefix, txt, sep="")
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(~cover_CCA+cover_LC+cover_MA+canopy_MA+cover_TA+canopy_TA+rugosity, data=data,
      lower.panel=panel.smooth, upper.panel=panel.cor, 
      pch=20, main="Benthic Community Variables",na.action = na.omit)
```

All benthic variables are highly correlated. I can omit cover_CCA and cover_MA (accounted for by canopy_MA). The rest should be combined via PCA. First I will assess remaining correlations between selected benthic and fish community variables:

```{r,echo=FALSE}
panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits=digits)[1]
    txt <- paste(prefix, txt, sep="")
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(~scar.BM+scar.DEN+carn.BM+cover_LC+cover_TA+canopy_MA+canopy_TA+rugosity, data=data,
      lower.panel=panel.smooth, upper.panel=panel.cor, 
      pch=20, main="Selected Fish and Benthic Variables",na.action = na.omit)
```

Unsure how to proceed here if I do end up using both benthic and fish community variables as predictors, because some are corellated (esp. scarid.BM.s and all benthic variables....). It looks like I would integrate scar.BM and carn.BM into a PCA with all other benthic/rugosity variables. Variables scar.DEN and conspec.DEN are relatively independent of all other variables (except each other). 

Current outline for site-level PCA tasks:
If benthic=predictor:
- cover_LC + cover_TA + canopy_MA + canopy_TA + rugosity + scar.BM + carn.BM
- scar.DEN + conspec.DEN
If benthic=response:
- rugosity + scar.BM + carn.BM
- cover_LC + cover_TA + canopy_MA + canopy_TA
- scar.DEN + conspec.DEN

## Fish-level response variables: grazing behaviors

### Distributions
```{r,echo=FALSE,warning=FALSE}
grazing <- data %>% select(g.frac,FR,BR,for.dur,for.bites) %>% gather() %>% na.omit()
ggplot(grazing,aes(value))+facet_wrap(~ key, scales = "free")+ geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") 
```


### Corellations
```{r,echo=FALSE}
grazing <- data %>% select(g.frac,FR,BR,for.dur,for.bites)
cor=cor(grazing, use="pairwise.complete.obs")
ord <- order(cor[1, ])
cor_ord = cor[ord, ord]
plotcorr(cor_ord , col=my_colors[cor_ord*50+50] , mar=c(1,1,1,1)  )
```

```{r,echo=FALSE}
panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits=digits)[1]
    txt <- paste(prefix, txt, sep="")
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(~g.frac+FR+BR+for.dur+for.bites, data=data,
      lower.panel=panel.smooth, upper.panel=panel.cor, 
      pch=20, main="Grazing Response Variables",na.action = na.omit)
```

Variable for.bites is correlated with nearly all other variables, so will be omitted. Variables g.farc, FR. and for.dur are still correlated and should be assessed with a PCA. Variable BR can be a standalone variable.

```{r,echo=FALSE}
panel.cor <- function(x, y, digits=2, prefix="", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits=digits)[1]
    txt <- paste(prefix, txt, sep="")
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(~g.frac+FR+BR+for.dur, data=data,
      lower.panel=panel.smooth, upper.panel=panel.cor, 
      pch=20, main="Selected Grazing Response Variables",na.action = na.omit)
```

Grazing PCA:
- g.frac + FR + for.dur
- (BR as standalone)


# Exploratory bivariate plots

## Grazing as a function of fish length
```{r, echo=FALSE,warning=FALSE, eval=FALSE}
ggplot(data,aes(x=Length.cm,y=FR,colour=Island))+facet_grid(.~Species)+geom_point(shape=18)+scale_shape(solid=FALSE)+geom_smooth(method=lm, fullrange=FALSE)+ggtitle("Feeding rate by fish length") + theme_minimal() +labs(y="Feeding Rate (bites/hr)",x="Length (cm)") + theme(plot.title = element_text(hjust = 0.5))  + scale_color_manual(values=c("navy", "darkseagreen", "slategray2"))
```
```{r, echo=FALSE,warning=FALSE, eval=FALSE}
ggplot(data,aes(x=Length.cm,y=BR,colour=Island))+facet_grid(.~Species)+geom_point(shape=18)+scale_shape(solid=FALSE)+geom_smooth(method=lm, fullrange=FALSE)+ggtitle("Bite rate (while grazing) by fish length") + theme_minimal() +labs(y="Bite Rate (bites/sec)",x="Length (cm)") + theme(plot.title = element_text(hjust = 0.5))  + scale_color_manual(values=c("navy", "darkseagreen", "slategray2"))
```

```{r, echo=FALSE,warning=FALSE, eval=FALSE}
ggplot(data,aes(x=Length.cm,y=g.frac,colour=Island))+facet_grid(.~Species)+geom_point(shape=18)+scale_shape(solid=FALSE)+geom_smooth(method=lm, fullrange=FALSE)+ggtitle("Fraction of time spend grazing by fish length") + theme_minimal() +labs(y="Time Fraction",x="Length (cm)") + theme(plot.title = element_text(hjust = 0.5))  + scale_color_manual(values=c("navy", "darkseagreen", "slategray2"))
```


## Grazing as a function of scarid biomass and density

```{r}
anubon <- data %>% filter(Island!="Barbuda")
ggplot(anubon,aes(x=scar.BM,y=FR))+facet_grid(.~Species)+geom_smooth(method="loess")+geom_point(shape=18)+ggtitle("Feeding rate by scarid biomass") + theme_minimal() +labs(y="Feeding rate (bites/hr)",x="Scarid Biomass (g/100m2)") + theme(plot.title = element_text(hjust = 0.5))
```

```{r,echo=FALSE,warning=FALSE}
ggplot(data,aes(x=scar.BM,y=FR,colour=Island))+facet_grid(.~Species)+geom_point(shape=18)+geom_smooth(method=lm, fullrange=FALSE)+ggtitle("Feeding rate by phase and scarid biomass") + theme_minimal() +labs(y="Feeding rate (bites/hr)",x="Scarid Biomass (g/100m2)") + theme(plot.title = element_text(hjust = 0.5)) + scale_color_manual(values=c("navy", "darkseagreen", "slategray2"))
```

```{r,echo=FALSE,warning=FALSE}
ggplot(data,aes(x=scar.BM,y=FR,colour=Phase))+facet_grid(.~Species)+geom_point(shape=18)+geom_smooth(method=loess, fullrange=FALSE)+ggtitle("Feeding rate by phase and scarid biomass") + theme_minimal() +labs(y="Feeding rate (bites/hr)",x="Scarid Biomass (g/100m2)") + theme(plot.title = element_text(hjust = 0.5)) + scale_color_manual(values=c("gray40", "aquamarine3"))
```

```{r, echo=FALSE,warning=FALSE, eval=FALSE}
ggplot(data,aes(x=scar.BM,y=BR,colour=Phase))+facet_grid(.~Species)+geom_point(shape=18)+geom_smooth(method=lm, fullrange=FALSE)+ggtitle("Bite rates (while grazing) by scarid biomass") + theme_minimal() +labs(y="Bite rate (bites/sec)",x="Scarid Biomass (g/100m2)") + theme(plot.title = element_text(hjust = 0.5)) + scale_color_manual(values=c("gray40", "aquamarine3"))
```

```{r,echo=FALSE,warning=FALSE}
ggplot(data,aes(x=scar.BM,y=g.frac,colour=Phase))+facet_grid(.~Species)+geom_point(shape=18)+geom_smooth(method=lm, fullrange=FALSE)+ggtitle("Fraction of time spent grazing by phase and scarid biomass") + theme_minimal() +labs(y="Time Fraction",x="Scarid Biomass (g/100m2)") + theme(plot.title = element_text(hjust = 0.5)) + scale_color_manual(values=c("gray40", "aquamarine3"))
```
```{r,echo=FALSE,warning=FALSE}
ggplot(data,aes(x=scar.BM,y=for.bites,colour=Phase))+facet_grid(.~Species)+geom_point(shape=18)+geom_smooth(method=lm, fullrange=FALSE)+ggtitle("Bites per foray by phase and scarid biomass") + theme_minimal() +labs(y="Bites",x="Scarid Biomass (g/100m2)") + theme(plot.title = element_text(hjust = 0.5)) + scale_color_manual(values=c("gray40", "aquamarine3"))
```


## Competitive interactions
```{r,echo=FALSE,warning=FALSE}
ggplot(site.sum,aes(x=scar.BM,y=int.scar.mean, shape=Island))+geom_point(size=3)+ggtitle("Interaction frequency as a function of scarid biomass") + theme_minimal() + theme(plot.title = element_text(hjust = 0.5)) + labs(x="Scarid Biomass (g/100m2)", y="Interactions with other scarids (per 2 min follow)") + geom_errorbar(aes(ymin=int.scar.mean-int.scar.se, ymax=int.scar.mean+int.scar.se))
```
```{r,echo=FALSE,warning=FALSE}
ggplot(site.sum,aes(x=scar.BM,y=int.scar.mean_stop, shape=Island))+geom_point(size=3)+ggtitle("S. viride interaction frequency as a function of scarid biomass") + theme_minimal() + theme(plot.title = element_text(hjust = 0.5)) + labs(x="Scarid Biomass (g/100m2)", y="Interactions with other scarids (per 2 min follow)") + geom_errorbar(aes(ymin=int.scar.mean_stop-int.scar.se_stop, ymax=int.scar.mean_stop+int.scar.se_stop))
```
```{r,echo=FALSE,warning=FALSE}
ggplot(site.sum,aes(x=scar.BM,y=int.scar.mean_qup, shape=Island))+geom_point(size=3)+ggtitle("S. vetula interaction frequency as a function of scarid biomass") + theme_minimal() + theme(plot.title = element_text(hjust = 0.5)) + labs(x="Scarid Biomass (g/100m2)", y="Interactions with other scarids (per 2 min follow)") + geom_errorbar(aes(ymin=int.scar.mean_qup-int.scar.se_qup, ymax=int.scar.mean_qup+int.scar.se_qup))
```
```{r,echo=FALSE,warning=FALSE}
ggplot(data,aes(x=scar.BM,y=int.scar))+facet_grid(.~Species)+geom_point(shape=19)+geom_smooth(method=lm)+ggtitle("Competitive interactions as a function of scarid biomass") + theme_minimal() + theme(plot.title = element_text(hjust = 0.5))
```



# PCAs
*Do I need to normalize my variables pre-PCA? Currently just scaled, except for grazing response variables which are log-transformed*

## Predictors

### All predictors
```{r}
predictors <- site.sum %>% select(cover_LC,cover_TA,canopy_MA,canopy_TA,rugosity,scar.BM,scar.DEN,carn.BM) # should it matter if I use site level summary data vs. full follow dataset (where site-level data has been joined?)
pca <- prcomp(na.omit(predictors),center = TRUE,scale. = TRUE) 
summary(pca)

plot(pca,type="l")
ggbiplot(pca, obs.scale = 1, var.scale = 1, groups=site.sum$Island, ellipse = TRUE, circle = TRUE, varname.size = 2) + scale_color_manual(name="Island", values=c("navy", "darkseagreen", "slategray2")) + theme(legend.direction = 'horizontal', legend.position = 'top') + theme_minimal()
```
### Benthic variables
```{r, echo=FALSE}
pred.benthic <- site.sum %>% select(cover_LC,cover_TA,canopy_MA,canopy_TA,rugosity) # should it matter if I use site level summary data vs. full follow dataset (where site-level data has been joined?)
pca1 <- prcomp(na.omit(pred.benthic),center = TRUE,scale. = TRUE) 

ggbiplot(pca1, obs.scale = 1, var.scale = 1, groups=site.sum$Island, ellipse = TRUE, circle = TRUE, loadings.label.repel=TRUE, varname.size=2.5, varname.adjust=1.1) + scale_color_manual(name="Island", values=c("navy", "darkseagreen", "slategray2")) + theme(legend.direction = 'horizontal', legend.position = 'top') + theme_minimal()

# add PC1 and PC2 as variables in dataset
pca1.scores <- as.data.frame(pca1$x) %>% select(PC1,PC2)
site.sum <- site.sum  %>% bind_cols(pca1.scores)
pca1.scores <- select(site.sum,Site,PC1,PC2)
data2 <- data %>% left_join(pca1.scores,by="Site")

setwd("~/github/Scarid-Behavior/data")
write.csv(data2,file = "data2.csv")
```
### Fish community variables
```{r}
pred.fish <- site.sum %>% select(scar.BM,scar.DEN,carn.BM) # should it matter if I use site level summary data vs. full follow dataset (where site-level data has been joined?)
pca2 <- prcomp(na.omit(pred.fish),center = TRUE,scale. = TRUE) 
summary(pca2)

plot(pca2,type="l")
ggbiplot(pca2, obs.scale = 1, var.scale = 1, groups=site.sum$Island, ellipse = TRUE, circle = TRUE, loadings.label.repel=TRUE) + scale_color_manual(name="Island", values=c("navy", "darkseagreen", "slategray2")) + theme(legend.direction = 'horizontal', legend.position = 'top') + theme_minimal()

```


## Response variables

### Grazing behaviors
*log transform increases P1 explained variance here...*
*Currently for.dur has several NA values (for individuals that didn't graze)... I am omitting that variable for now because I don't want to omit non-grazing individuals (instead would like to keep them as grazing=0*
```{r}
response <- data %>% select(g.frac,TDB,BR)
log.vars5 <- log(response[,1:3])
pca3 <- prcomp(na.omit(response),center = TRUE,scale. = TRUE) 
summary(pca3)
plot(pca3,type="l")
ggbiplot(pca3, obs.scale = 1, var.scale = 1, groups=data$Island,shape=data$Island,ellipse = TRUE, circle = TRUE, alpha=0.8,varname.size = 5) + theme_minimal() + scale_color_manual(name="Island", values=c("navy", "darkseagreen", "slategray2")) + labs(title="Grazing behaviors by island") + theme(plot.title = element_text(hjust = 0.5))
```
```{r}
response <- data %>% select(g.frac,FR,BR)
log.vars5 <- log(response[,1:3])
pca3 <- prcomp(na.omit(response),center = TRUE,scale. = TRUE) 
summary(pca3)
plot(pca3,type="l")
ggbiplot(pca3, obs.scale = 1, var.scale = 1,ellipse = TRUE, circle = TRUE, alpha=0.4,varname.size = 5) + theme(legend.direction = 'horizontal', legend.position = 'top') + theme_minimal() +geom_point(aes(col=data$scar.BM)) + labs(col="Scarid Biomass (g/100m2)", title="Grazing Behaviors by Scarid Biomass") + theme(plot.title = element_text(hjust = 0.5))
```

```{r,echo=FALSE}
vir <- data %>% filter(Species.Code=="stop")
response <- vir %>% select(g.frac,FR,BR)
log.vars5 <- log(response[,1:3])
pcavir <- prcomp(na.omit(response),center = TRUE,scale. = TRUE) 
ggbiplot(pcavir, obs.scale = 1, var.scale = 1,ellipse = TRUE, circle = TRUE, alpha=1,varname.size = 5) + theme(legend.direction = 'horizontal', legend.position = 'top') + theme_minimal() + labs(col="Scarid Biomass (g/100m2)", title="Grazing Behaviors by Scarid Biomass") + theme(plot.title = element_text(hjust = 0.5)) +geom_point(aes(colour=vir$scar.BM))
```
```{r,echo=FALSE}
vet <- data %>% filter(Species.Code=="qup")
response <- vet %>% select(g.frac,FR,BR)
log.vars5 <- log(response[,1:3])
pcavet <- prcomp(na.omit(response),center = TRUE,scale. = TRUE) 
ggbiplot(pcavet, obs.scale = 1, var.scale = 1,ellipse = TRUE, circle = TRUE, alpha=1,varname.size = 5) + theme(legend.direction = 'horizontal', legend.position = 'top') + theme_minimal() + labs(col="Scarid Biomass (g/100m2)", title="Grazing Behaviors by Scarid Biomass") + theme(plot.title = element_text(hjust = 0.5)) +geom_point(aes(colour=vet$scar.BM))
```

# Model trials: all species compiled

## Basic lm to assess predictors of interest
-site-level predictors: scar.BM,scar.DEN,carn.BM,benthic (PC1,PC2)
-fish-level predictors: species, phase, length
--eventually run separately for different species
--species*scar.BM interaction?
-random effects: island
-response variables: g.frac, BR (?), and FR (run separately)

### Feeding rates
```{r}
initial<-data%>%filter(Phase=="i") # for analysis with initial only
lm_FR <- lm(FR~scar.BM*Species+Phase+carn.BM+Length.cm+PC1+PC2, data=data)
summary(lm_FR)
#vif(lm_FR)
```
*Notes: nearly everything is significant? Significant interaction between scar.BM and species for Spar. viride. carn.BM and scar.BM are highly positively correlated (~0.86) - is it ok to include both?*
*R2 goes up slightly with initial only*

### Fraction of time grazing
```{r}
lm_g.frac <- lm(g.frac~Species*scar.BM+Phase+scar.DEN+carn.BM+Phase+Length.cm+PC1+PC2, data=data)
summary(lm_g.frac)
```
*Notes: carn.BM and PC1 are strongest predictors of time spent grazing, scar.BM and phase are also significant. Slight significance of species, length, and species-scar.BM interaction*

## Mixed effects models
- random effect: island

### Feeding rates
```{r}
lme_FR <- lme(FR~Phase+Length.cm+Species*scar.BM+scar.DEN+carn.BM+PC1+PC2,data=data,random=~1|Island, na.action = na.omit)
summary(lme_FR)
```
*Notes: nearly everything is significant except for PC2 and scar.DEN?*

### Fraction of time spent grazing
```{r}
lme_g.frac <- lme(g.frac~Phase+Length.cm+Species*scar.BM+scar.DEN+carn.BM+PC1+PC2,data=data,random=~1|Island, na.action = na.omit)
summary(lme_g.frac)
```
*Notes: carn.BM and phase are strongest predictors, followed by scar.BM, PC1, and length. Also significant interaction between *

# Model trials: species run individually
```{r}
stop<-data%>%filter(Species.Code=="stop")
qup<-data%>%filter(Species.Code=="qup")
rbp<-data%>%filter(Species.Code=="rbp")
```

## Feeding rates
```{r}
lme_FR_stop <- lme(FR~Phase+Length.cm+scar.BM+scar.DEN+carn.BM+PC1+PC2,data=stop,random=~1|Island, na.action = na.omit)
summary(lme_FR_stop)
```
*Notes: carn.BM and length are signifigant predictors*

```{r}
lme_FR_qup <- lme(FR~Phase+Length.cm+scar.BM+scar.DEN+carn.BM+PC1+PC2,data=qup,random=~1|Island, na.action = na.omit)
summary(lme_FR_qup)
```
*Notes: PC1 is strongest (magnitude) predictors. Also significant are phase, carn.BM and scar.DEN*

```{r}
lme_FR_rbp <- lme(FR~Phase+Length.cm+scar.BM+scar.DEN+carn.BM+PC1+PC2,data=rbp,random=~1|Island, na.action = na.omit)
summary(lme_FR_rbp)
```
*Notes: much more variable, less predictable. Maybe take out of overall analysis?*

## GAMs

```{r, echo=FALSE}
vet<-data %>% filter(Species.Code=="qup")
gamvet<-gam(FR~Phase+s(Length.cm)+s(scar.BM)+(PC1)+(PC2), family=gaussian(link=identity),data=vet, method="REML")
summary(gamvet)
plot(gamvet)
```
```{r, echo=FALSE}
vir<-data %>% filter(Species.Code=="stop" & Site!="Snapper Point")
gammvir<-gamm(FR~Phase+s(Length.cm)+s(scar.BM)+s(carn.BM)+s(PC1)+s(PC2), family=gaussian(link=identity),data=vir, random=list(Island=~1),method="REML")
summary(gammvir)
plot(gammvir)
```
------------------------
To Do as of Nov. 7
* ~~incorporate PCs~~
* boosted regression trees ecosphere 2017 adrians paper
* ~~simpler graphs with just herb density x axis - grazing behaviors y, facet by species~~
* ~~Species*density as fixed effect~~
* Species as random effect
* ~~break out species and run separately~~  
