---
title: 'Structural '
author: "Molly Wilson"
date: "3/14/2018"
output:
  html_document:
    number_sections: yes
    theme: united
    toc: yes
    toc_float: yes
    toc_depth: 3
  pdf_document:
    toc: yes
---

```{r,message=FALSE,warning=FALSE, echo=FALSE}
# set up
library(tidyr)
library(lavaan)
library(semPlot)
```

```{r,message=FALSE,warning=FALSE, echo=FALSE}
sum_id <- read.csv(here("data","sum_id.csv"), stringsAsFactors=FALSE) %>% select(-X)
sum_site <- read.csv(here("data","sum_site.csv"), stringsAsFactors=FALSE) %>% select(-X)

# recode phase and species with dummy variables
# data <- data %>% mutate(spec.dum= 
#                           ifelse(Species.Code=="stop", 1, 
#                           (ifelse(Species.Code=="qup", 2,
#                           (ifelse(Species.Code=="rbp",3,NA)))))) %>%
#   mutate(phase.dum=ifelse(Phase=="i",1,2))


```

```{r}
# define model pathways
qup_df <- sum_id %>% 
  select(scar_bm, ma_cover, ta_cover, fr, g_frac, rugosity, int_scar, length_cm, lc_cover) %>% 
  na.omit()

sem <- '
  # latent variable indicators  
      risk =~ scar_bm + rugosity
      nutrition =~ ma_cover + ma_canopy + ta_cover + ta_canopy
  # regressions
      fr ~ length_cm + risk + nutrition
      rugosity ~ lc_cover
      lc_cover ~ ma_cover + ta_cover
      ta_cover ~ scar_bm
      ma_cover ~ scar_bm
'

sem1 <- '
  # latent variable indicators
      risk =~ scar_bm      
      nutrition =~ ma_cover + ta_cover
  # regressions
      fr ~ length_cm + nutrition + risk
      lc_cover ~ ma_cover + ta_cover
'

fit <- sem(sem1, data=qup_df)
varTable(fit)
summary(fit, standardized=T, fit.measures=T,rsq=T)
semPaths(fit)
fitMeasures(fit, c("cfi","rmsea","srmr"))
```

